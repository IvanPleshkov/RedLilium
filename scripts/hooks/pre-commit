#!/usr/bin/env bash
# ============================================================================
# pre-commit - Git pre-commit hook for RedLilium Engine
# ============================================================================
# This hook runs cargo fmt --check before each commit to ensure code is
# properly formatted. The docs folder is excluded from formatting checks
# (it only contains documentation files, not Rust code).
#
# To install this hook, run:
#   ./scripts/setup-hooks.sh       (Linux/macOS)
#   .\scripts\setup-hooks.ps1      (Windows)
# ============================================================================

set -e

# Colors for output (disabled if not a terminal)
if [ -t 1 ]; then
    RED='\033[0;31m'
    GREEN='\033[0;32m'
    YELLOW='\033[1;33m'
    NC='\033[0m'
else
    RED=''
    GREEN=''
    YELLOW=''
    NC=''
fi

echo -e "${YELLOW}Running pre-commit hook: cargo fmt --check${NC}"

# Check if cargo is available
if ! command -v cargo &> /dev/null; then
    echo -e "${RED}Error: cargo not found. Please install Rust: https://rustup.rs/${NC}"
    exit 1
fi

# Run cargo fmt check on the workspace
# Note: The docs folder only contains markdown files and is not part of the
# Cargo workspace, so it is automatically excluded from formatting checks.
if cargo fmt --all -- --check; then
    echo -e "${GREEN}Formatting check passed!${NC}"
    exit 0
else
    echo -e "${RED}Formatting check failed!${NC}"
    echo ""
    echo -e "${YELLOW}Please run 'cargo fmt --all' to fix formatting issues before committing.${NC}"
    echo ""
    exit 1
fi
